<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>12 Refleksionskort</title>

  <style>
    :root{
      --bg:#0b1220;
      --card:rgba(255,255,255,.06);
      --card2:rgba(255,255,255,.09);
      --text:#eaf0ff;
      --muted:rgba(234,240,255,.75);
      --stroke:rgba(255,255,255,.12);
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --radius:18px;
      --danger:#ff3b3b;
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:
        radial-gradient(1200px 900px at 20% 0%, rgba(110,168,255,.25), transparent 60%),
        radial-gradient(1200px 900px at 90% 20%, rgba(120,255,214,.14), transparent 55%),
        var(--bg);
      color:var(--text);
      min-height:100vh;
      padding:28px;
      padding-bottom:88px; /* plads til stop-knap bar */
    }

    header{
      max-width:1100px;
      margin:0 auto 18px;
      display:flex;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }

    h1{ margin:0; font-size:20px; }

    .hint{
      margin:0;
      font-size:13px;
      color:var(--muted);
    }

    .grid{
      max-width:1100px;
      margin:0 auto;
      display:grid;
      grid-template-columns:repeat(4,1fr);
      gap:14px;
    }

    @media(max-width:900px){
      .grid{ grid-template-columns:repeat(2,1fr); }
    }
    @media(max-width:520px){
      .grid{ grid-template-columns:1fr; }
    }

    .card{
      position:relative;
      min-height:140px; /* lidt højere pga. knapper */
      padding:14px;
      border-radius:var(--radius);
      border:1px solid var(--stroke);
      background:linear-gradient(180deg,var(--card),rgba(255,255,255,.04));
      box-shadow:var(--shadow);
      cursor:pointer;
      transition:.15s ease;
    }

    .card:hover{
      transform:translateY(-1px);
      background:linear-gradient(180deg,var(--card2),rgba(255,255,255,.05));
    }

    .titleRow{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      padding-right:26px; /* plads til blyant */
    }

    .title{
      font-weight:650;
      font-size:14px;
      line-height:1.2;
    }

    .meta{
      position:absolute;
      top:12px;
      right:12px;
      font-size:12px;
      opacity:.6;
      pointer-events:none;
    }

    /* Lydknapper */
    .audioBtns{
      display:flex;
      gap:8px;
      flex-shrink:0;
    }

    .audioBtn{
      border:1px solid rgba(255,255,255,.18);
      background:rgba(5,10,20,.45);
      color:var(--text);
      border-radius:10px;
      font-size:12px;
      line-height:1;
      padding:7px 9px;
      cursor:pointer;
      transition:.15s ease;
      user-select:none;
    }

    .audioBtn:hover{
      border-color:rgba(110,168,255,.6);
      box-shadow:0 0 0 3px rgba(110,168,255,.18);
      transform:translateY(-1px);
    }

    .audioBtn:active{
      transform:translateY(0px);
    }

    .audioStatus{
      margin-top:10px;
      font-size:12px;
      color:var(--muted);
      min-height:16px;
      word-break:break-word;
    }

    .editorWrap{
      margin-top:10px;
      max-height:0;
      opacity:0;
      transform:scaleY(.95);
      transform-origin:top;
      transition:.25s ease;
      pointer-events:none;
    }

    .card.open .editorWrap{
      max-height:260px;
      opacity:1;
      transform:scaleY(1);
      pointer-events:auto;
    }

    textarea{
      width:100%;
      min-height:90px;
      resize:vertical;
      padding:12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.15);
      background:rgba(5,10,20,.45);
      color:var(--text);
      font-size:13px;
    }

    textarea:focus{
      outline:none;
      border-color:rgba(110,168,255,.6);
      box-shadow:0 0 0 3px rgba(110,168,255,.2);
    }

    .closeHint{
      margin-top:8px;
      font-size:12px;
      opacity:.6;
    }

    /* Bundbar med STOP */
    .bottomBar{
      position:fixed;
      left:0;
      right:0;
      bottom:0;
      z-index:999;
      padding:12px 16px;
      border-top:1px solid rgba(255,255,255,.12);
      background:rgba(11,18,32,.75);
      backdrop-filter: blur(10px);
    }

    .bottomInner{
      max-width:1100px;
      margin:0 auto;
      display:flex;
      justify-content:flex-end;
    }

    .stopBtn{
      border:1px solid rgba(255,255,255,.15);
      background:rgba(255,59,59,.92);
      color:white;
      font-weight:700;
      border-radius:14px;
      padding:10px 14px;
      cursor:pointer;
      transition:.15s ease;
      letter-spacing:.2px;
      user-select:none;
    }

    .stopBtn:hover{
      transform:translateY(-1px);
      box-shadow:0 10px 22px rgba(255,59,59,.15);
    }

    .stopBtn:active{ transform:translateY(0px); }
  </style>
</head>

<body>

<header>
  <h1>Nøglebegreber</h1>
  <p class="hint">Klik på et kort for at skrive – teksten gemmes automatisk. Tryk på 1/2 for at afspille mp3.</p>
</header>

<main class="grid" id="grid"></main>

<!-- Rød stop-knap i bunden -->
<div class="bottomBar" role="region" aria-label="Lydkontrol">
  <div class="bottomInner">
    <button class="stopBtn" id="stopAll" type="button">STOP LYD</button>
  </div>
</div>

<script>
  const STORAGE_KEY = "refleksionskort_data_v1";

  // 12 titler i alfabetisk orden (venstre→højre pr. række)
  const titles = [
    "Antropologen",
    "Coachens input",
    "Erkendelse",
    "Evaluering",
    "Fremtidsforskeren",
    "Kaptajnen",
    "Mentalisering",  // <-- fjernet ?
    "Neutralitet",
    "Nøgleord",
    "Spejling",
    "Uærbødighed",
    "Værdsættende"
  ];

  const grid = document.getElementById("grid");
  let openCard = null;

  // Én global audio-player
  const player = new Audio();
  player.preload = "none";
  let currentStatusEl = null;

  // hent gemte data
  const savedData = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");

  function save(index, value){
    savedData[index] = value;
    localStorage.setItem(STORAGE_KEY, JSON.stringify(savedData));
  }

  // Gør titel til et filnavn: fjern ? og trim.
  function titleToFileBase(title){
    return title.replaceAll("?", "").trim();
  }

  function setStatus(el, text){
    el.textContent = text || "";
  }

  function stopAllAudio(){
    player.pause();
    player.currentTime = 0;
    if (currentStatusEl) setStatus(currentStatusEl, "");
    currentStatusEl = null;
  }

  function playFile(file, statusEl){
    const sameFile =
      (player.src && player.src.endsWith("/" + file)) ||
      (player.src && player.src.endsWith(file));

    if (currentStatusEl && currentStatusEl !== statusEl){
      setStatus(currentStatusEl, "");
    }
    currentStatusEl = statusEl;

    if (sameFile && !player.paused){
      player.pause();
      setStatus(statusEl, "Pause: " + file);
      return;
    }

    player.pause();
    player.currentTime = 0;
    player.src = file;

    setStatus(statusEl, "Afspiller: " + file);

    player.play().catch(() => {
      setStatus(statusEl, "Fejl: Kan ikke afspille / fil ikke fundet: " + file);
    });
  }

  player.addEventListener("ended", () => {
    if (currentStatusEl) setStatus(currentStatusEl, "");
  });

  player.addEventListener("error", () => {
    if (currentStatusEl) setStatus(currentStatusEl, "Fejl: Kan ikke afspille filen");
  });

  function makeCard(title, index){
    const card = document.createElement("div");
    card.className = "card";

    const titleRow = document.createElement("div");
    titleRow.className = "titleRow";

    const titleEl = document.createElement("div");
    titleEl.className = "title";
    titleEl.textContent = title;

    const btnWrap = document.createElement("div");
    btnWrap.className = "audioBtns";

    const status = document.createElement("div");
    status.className = "audioStatus";

    const base = titleToFileBase(title);

    const btn1 = document.createElement("button");
    btn1.type = "button";
    btn1.className = "audioBtn";
    btn1.textContent = "1";
    btn1.addEventListener("click", (e) => {
      e.stopPropagation();
      playFile(`${base}-1.mp3`, status);
    });

    const btn2 = document.createElement("button");
    btn2.type = "button";
    btn2.className = "audioBtn";
    btn2.textContent = "2";
    btn2.addEventListener("click", (e) => {
      e.stopPropagation();
      playFile(`${base}-2.mp3`, status);
    });

    btnWrap.append(btn1, btn2);
    titleRow.append(titleEl, btnWrap);

    const meta = document.createElement("div");
    meta.className = "meta";
    meta.textContent = "✎";

    const wrap = document.createElement("div");
    wrap.className = "editorWrap";

    const textarea = document.createElement("textarea");
    textarea.placeholder = "Skriv dine noter her…";
    textarea.value = savedData[index] || "";

    textarea.addEventListener("input", () => save(index, textarea.value));
    textarea.addEventListener("click", e => e.stopPropagation());

    const hint = document.createElement("div");
    hint.className = "closeHint";
    hint.textContent = "Klik udenfor for at lukke";

    wrap.append(textarea, hint);

    card.append(titleRow, meta, status, wrap);

    card.addEventListener("click", () => {
      if (openCard && openCard !== card) {
        openCard.classList.remove("open");
      }
      card.classList.add("open");
      openCard = card;
      setTimeout(() => textarea.focus(), 40);
    });

    return card;
  }

  titles.forEach((t, i) => grid.appendChild(makeCard(t, i)));

  // Stop-knap
  document.getElementById("stopAll").addEventListener("click", (e) => {
    e.stopPropagation();
    stopAllAudio();
  });

  document.addEventListener("click", e => {
    if (openCard && !openCard.contains(e.target)) {
      openCard.classList.remove("open");
      openCard = null;
    }
  });

  document.addEventListener("keydown", e => {
    if (e.key === "Escape" && openCard) {
      openCard.classList.remove("open");
      openCard = null;
    }
    if (e.key === "Escape") {
      // bonus: ESC stopper også lyd
      stopAllAudio();
    }
  });
</script>

</body>
</html>
